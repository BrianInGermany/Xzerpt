<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://miro.com/app/static/sdk.1.1.js"></script>
    <script>
        function clear_and_gen_cards(){
            
            var csv_data = localStorage.getItem('all_csv');
            console.log("this is csv_data");
            console.log(csv_data);
            var rows = csv_data.split('\\r\\n');
            rows = rows[0].split('\r\n');
            console.log("this is rows:");
            console.log(rows);
       

            for (row of rows){
                if (row == ''){
                    continue;
                }
                id_count += 1;
                console.log("this is a row")
                console.log(row)
                var fields = row.split('|');
                
                miro.board.widgets.create({"type": "card","title": fields[3], "description": fields[4]});
             
                
              
                }
            localStorage.setItem('all_csv', '');
        }
        function dragOverHandler(ev) {
            console.log('File(s) in drop zone');
    
            // Prevent default behavior (Prevent file from being opened)
            ev.preventDefault();
            }
       
        function removeDragData(ev) {
      console.log('Removing drag data');
    
      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to remove the drag data
        ev.dataTransfer.items.clear();
      } else {
        // Use DataTransfer interface to remove the drag data
        ev.dataTransfer.clearData();
        document.getElementById("drop_zone").innerHTML = "Drag file(s) here to create Xzerpt cards from.";
      }
    }
        
    function dropHandler(ev) {
        // alert("Files Dropped!")
      
     
      console.log('File(s) dropped');
    
      // Prevent default behavior (Prevent file from being opened)
      ev.preventDefault();
    
      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.items.length; i++) {
          // If dropped items aren't files, reject them
          if (ev.dataTransfer.items[i].kind === 'file') {
            var file = ev.dataTransfer.items[i].getAsFile();
            var fileNameP = document.createElement("li");
            fileNameP.innerHTML = ev.dataTransfer.files[i].name;
            document.getElementById("drop_zone").appendChild(fileNameP);
            console.log('... file[' + i + '].name = ' + file.name);
          
            var fr = new FileReader();
        fr.onload = function(e) {
            // e.target.result should contain the text
            appendToStorage('all_csv', e.target.result.toString());
        };
        fr.readAsText(file);
          }
        }
      } else {
        // Use DataTransfer interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.files.length; i++) {
          console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
          var fileNameP = document.createElement("li");
            fileNameP.innerHTML = ev.dataTransfer.files[i].name;
            document.getElementById("drop_zone").appendChild(fileNameP);
          var fr = new FileReader();
        fr.onload = function(e) {
            // e.target.result should contain the text
            appendToStorage('all_csv', e.target.result.toString());
        };
        fr.readAsText(file);
       
      
        
        }
        
      } 
        console.log("heres local csv storage:");
        console.log(localStorage.getItem('all_csv'));
      // Pass event to removeDragData for cleanup
      removeDragData(ev)
    }
        
    
    
        
    </script>
    <script>
        function addDropField(){
            var div = document.createElement('div');
            div.setAttribute('class', 'container');
            div.setAttribute('ondrop', "dropHandler(event);");
            div.setAttribute('id', "drop_zone");
            div.setAttribute('ondragover', "dragOverHandler(event);" );
            div.innerHTML = "<button type='button' id='send_files' onclick='clear_and_gen_cards()'>Create Cards</button><br/><ul id='drop_text'>Drag file(s) here to create Xzerpt cards from.</ul>";
        
            document.getElementsByClassName('angular-root ally-app-root')[0].appendChild(div);
        
        
        
        }
        </script>
    <script>
       
       miro.onReady(() => {
  miro.initialize({
    extensionPoints: {
      bottomBar: {
        title: 'Xzerpt Cards',
        svgIcon:
          '<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
  
        onClick: async () => {
            //create input interface (Drag n Drop)
            addDropField();
       
          // Show success message
          miro.showNotification('CSV drop field created. Drop Xzerpt file(s) to continue')
        },
      },
    },
  })
})
function dragOverHandler(ev) {
            console.log('File(s) in drop zone');
    
            // Prevent default behavior (Prevent file from being opened)
            ev.preventDefault();
            }
       
        function removeDragData(ev) {
      console.log('Removing drag data');
    
      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to remove the drag data
        ev.dataTransfer.items.clear();
      } else {
        // Use DataTransfer interface to remove the drag data
        ev.dataTransfer.clearData();
        document.getElementById("drop_zone").innerHTML = "Drag file(s) here to create Xzerpt cards from.";
      }
    }
function dropHandler(ev) {
        // alert("Files Dropped!")
      
     
      console.log('File(s) dropped');
    
      // Prevent default behavior (Prevent file from being opened)
      ev.preventDefault();
    
      if (ev.dataTransfer.items) {
        // Use DataTransferItemList interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.items.length; i++) {
          // If dropped items aren't files, reject them
          if (ev.dataTransfer.items[i].kind === 'file') {
            var file = ev.dataTransfer.items[i].getAsFile();
            var fileNameP = document.createElement("li");
            fileNameP.innerHTML = ev.dataTransfer.files[i].name;
            document.getElementById("drop_zone").appendChild(fileNameP);
            console.log('... file[' + i + '].name = ' + file.name);
          
            var fr = new FileReader();
        fr.onload = function(e) {
            // e.target.result should contain the text
            appendToStorage('all_csv', e.target.result.toString());
        };
        fr.readAsText(file);
          }
        }
      } else {
        // Use DataTransfer interface to access the file(s)
        for (var i = 0; i < ev.dataTransfer.files.length; i++) {
          console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
          var fileNameP = document.createElement("li");
            fileNameP.innerHTML = ev.dataTransfer.files[i].name;
            document.getElementById("drop_zone").appendChild(fileNameP);
          var fr = new FileReader();
        fr.onload = function(e) {
            // e.target.result should contain the text
            appendToStorage('all_csv', e.target.result.toString());
        };
        fr.readAsText(file);
       
      
        
        }
        
      } 
        console.log("heres local csv storage:");
        console.log(localStorage.getItem('all_csv'));
      // Pass event to removeDragData for cleanup
      removeDragData(ev)
    }
        
    
    
        
</script>

</head>

</html>